# 次のタスク整理

## 📋 タスク一覧（優先度順）

### 🔴 最優先タスク（即座に実施すべき）

#### 1. セッション開始時の企業情報自動取得機能の実装
**現状**: 詳細診断モードでセッション開始時に、企業情報を手動で入力する必要がある  
**目標**: `company_id`を指定した場合、企業情報から自動的に`industry`、`customer_persona`、`customer_pain`を取得

**実装内容**:
- `POST /api/session/start/` APIで`company_id`が指定された場合
- `Company`モデルから企業情報を取得
- `CompanyAnalysis`があれば推奨事項から`customer_pain`を取得
- 自動的にセッション情報を構築

**参考**: `AIdocs/COMPANY_INFO_USAGE_LOGIC.md` の「実装が必要な改善点」セクション

**影響範囲**:
- `backend/spin/views.py` - `start_session`関数
- `backend/spin/serializers.py` - `SessionSerializer`（必要に応じて）

**見積もり**: 1-2時間

---

#### 2. チャット時の企業情報活用機能の完全実装
**現状**: 部分的に実装済みだが、企業情報の活用が不十分な可能性  
**目標**: 詳細診断モードで企業情報を最大限活用したAI顧客応答を生成

**実装内容**:
- `generate_customer_response`関数で企業情報を詳細に活用
- 企業情報から顧客人格を構築する関数の追加
- 企業情報を参照したより具体的な応答生成

**参考**: `AIdocs/COMPANY_INFO_USAGE_LOGIC.md` の「企業情報を活用する場合の改善案」セクション

**影響範囲**:
- `backend/spin/services/openai_client.py` - `generate_customer_response`関数
- 新規関数: `build_persona_from_company`（必要に応じて）

**見積もり**: 2-3時間

---

### 🟡 高優先度タスク（機能改善）

#### 3. SPIN質問生成をオプション機能にする
**現状**: SPIN質問生成が必須ステップになっている  
**目標**: SPIN質問生成を「参考として見る（オプション）」機能に変更し、セッション開始を直接可能にする

**実装内容**:
- フロントエンドUI変更
  - 「SPIN質問を生成」ボタンを「参考としてSPIN質問を見る（オプション）」に変更
  - 「セッションを開始」ボタンを直接配置
- 質問生成を経由せずにセッション開始可能にする

**参考**: `AIdocs/SPIN_QUESTION_GENERATION_IMPROVEMENT.md`

**影響範囲**:
- `frontend/app.js` - UIフロー変更
- `frontend/index.html` - ボタン配置変更

**見積もり**: 1-2時間

---

#### 4. ログの改善（モード情報の完全な反映）
**現状**: 一部のログにモード情報が含まれているが、すべてのログに含まれていない可能性  
**目標**: すべてのログに`mode`情報を含める

**実装内容**:
- すべてのログメッセージに`mode={session.mode}`を追加
- エラーログにもモード情報を含める
- フロントエンドのエラーログにもモード情報を含める

**影響範囲**:
- `backend/spin/views.py` - すべてのログ
- `backend/spin/services/*.py` - すべてのログ
- `frontend/app.js` - エラーハンドリング

**見積もり**: 1時間

---

### 🟢 中優先度タスク（将来の機能拡張）

#### 5. 無料版の制限機能実装
**現状**: 無料版と有料版の区別がない  
**目標**: 無料版ユーザーに診断回数制限を実装

**実装内容**:
- `User`モデルにサブスクリプション情報を追加
  - `subscription_type`: サブスクリプションタイプ（free/basic/professional/enterprise）
  - `subscription_expires_at`: サブスクリプション有効期限
  - `diagnosis_count_this_month`: 今月の診断回数
- 診断回数のカウント機能
- 残り回数の表示
- 制限到達時の有料版への誘導

**参考**: `AIdocs/FUTURE_FEATURE_PLAN.md` の「Phase 1: 無料版の制限機能」セクション

**影響範囲**:
- `backend/spin/models.py` - Userモデル拡張（またはProfileモデル追加）
- `backend/spin/views.py` - セッション開始時の制限チェック
- `frontend/app.js` - 残り回数表示、制限到達時の表示

**見積もり**: 3-4時間

---

#### 6. 個人ダッシュボード機能
**現状**: ユーザーの成長を可視化する機能がない  
**目標**: スキル成長グラフ、SPIN各要素のスコア推移、成功率トレンド分析を表示

**実装内容**:
- ダッシュボード用の集計API作成
- フロントエンドにグラフ表示（Chart.js等を使用）
- スコア推移、成功率トレンドの可視化

**参考**: `AIdocs/FUTURE_FEATURE_PLAN.md` の「Phase 2: 有料版の基本機能強化」セクション

**影響範囲**:
- `backend/spin/views.py` - ダッシュボードAPI追加
- `frontend/app.js` - ダッシュボード画面追加
- `frontend/index.html` - ダッシュボードUI追加

**見積もり**: 4-6時間

---

#### 7. 詳細分析レポート（PDF/Excelエクスポート）
**現状**: レポートは画面表示のみ  
**目標**: PDF/Excel形式でのレポートエクスポート機能

**実装内容**:
- PDF形式でのレポート生成（ReportLabまたはWeasyPrint）
- Excel形式でのデータエクスポート（openpyxl）
- 会話履歴を含めた詳細レポート

**参考**: `AIdocs/FUTURE_FEATURE_PLAN.md` の「Phase 2: 有料版の基本機能強化」セクション

**影響範囲**:
- `backend/spin/views.py` - エクスポートAPI追加
- `backend/spin/services/` - レポート生成サービス追加
- `backend/requirements.txt` - 必要なライブラリ追加

**見積もり**: 4-6時間

---

### 🔵 低優先度タスク（将来的な検討事項）

#### 8. 弱点分析と改善提案機能
**現状**: 基本的なフィードバックのみ  
**目標**: SPIN各要素の弱点自動分析、過去の会話から改善パターンの抽出

**実装内容**:
- OpenAI APIを使用した弱点分析
- 過去のセッションデータとの比較
- 具体的な質問例の提案

**参考**: `AIdocs/FUTURE_FEATURE_PLAN.md` の「Phase 2: 有料版の基本機能強化」セクション

**見積もり**: 6-8時間

---

#### 9. ケーススタディライブラリ
**現状**: 実在企業のケースで練習する機能がない  
**目標**: 業界別の実在企業ケース（匿名化）を提供

**実装内容**:
- 新しいモデル: `CaseStudy`
- ケース管理用の管理画面
- ケース選択UI

**参考**: `AIdocs/FUTURE_FEATURE_PLAN.md` の「Phase 3: 有料版の高度機能」セクション

**見積もり**: 8-10時間

---

#### 10. チーム機能
**現状**: 個人利用のみ  
**目標**: チーム作成・参加、チーム内ランキング、チーム平均スコアの可視化

**実装内容**:
- 新しいモデル: `Team`, `TeamMember`
- チーム管理API
- チームダッシュボード

**参考**: `AIdocs/FUTURE_FEATURE_PLAN.md` の「Phase 3: 有料版の高度機能」セクション

**見積もり**: 10-12時間

---

## 📊 タスク優先度マトリックス

| タスク | 優先度 | 影響範囲 | 見積もり | ステータス |
|--------|--------|----------|----------|------------|
| 1. セッション開始時の企業情報自動取得 | 🔴 最優先 | 中 | 1-2時間 | 未着手 |
| 2. チャット時の企業情報活用の完全実装 | 🔴 最優先 | 中 | 2-3時間 | 部分的実装 |
| 3. SPIN質問生成をオプション機能に | 🟡 高 | 小 | 1-2時間 | 未着手 |
| 4. ログの改善（モード情報の完全な反映） | 🟡 高 | 小 | 1時間 | 部分的実装 |
| 5. 無料版の制限機能 | 🟢 中 | 大 | 3-4時間 | 未着手 |
| 6. 個人ダッシュボード | 🟢 中 | 大 | 4-6時間 | 未着手 |
| 7. 詳細分析レポート（PDF/Excel） | 🟢 中 | 中 | 4-6時間 | 未着手 |
| 8. 弱点分析と改善提案 | 🔵 低 | 中 | 6-8時間 | 未着手 |
| 9. ケーススタディライブラリ | 🔵 低 | 大 | 8-10時間 | 未着手 |
| 10. チーム機能 | 🔵 低 | 大 | 10-12時間 | 未着手 |

---

## 🎯 推奨される実装順序

### Phase 1: コア機能の完成（最優先）
1. **セッション開始時の企業情報自動取得機能**（タスク1）
2. **チャット時の企業情報活用の完全実装**（タスク2）
3. **ログの改善**（タスク4）

**合計見積もり**: 4-6時間

### Phase 2: UX改善
4. **SPIN質問生成をオプション機能に**（タスク3）

**合計見積もり**: 1-2時間

### Phase 3: ビジネスモデル対応
5. **無料版の制限機能**（タスク5）

**合計見積もり**: 3-4時間

### Phase 4: 機能拡張
6. **個人ダッシュボード**（タスク6）
7. **詳細分析レポート（PDF/Excel）**（タスク7）

**合計見積もり**: 8-12時間

---

## 📝 実装時の注意事項

### データベース変更が必要なタスク
- **タスク5**: Userモデル拡張またはProfileモデル追加
- **タスク9**: CaseStudyモデル追加
- **タスク10**: Team, TeamMemberモデル追加

### 外部ライブラリ追加が必要なタスク
- **タスク6**: Chart.js等のグラフライブラリ
- **タスク7**: ReportLab/WeasyPrint（PDF）、openpyxl（Excel）

### テストが必要なタスク
すべてのタスクで以下を実施：
- ユニットテスト
- 統合テスト
- 動作確認

---

## 🔍 実装前の確認事項

各タスクを実装する前に、以下を確認：
1. **AIdocs仕様書の確認**: 該当する仕様書を再確認
2. **既存コードの確認**: 影響範囲のコードを確認
3. **データベースのバックアップ**: 本番環境では必ずバックアップを取得
4. **テスト環境での動作確認**: ローカル環境で十分にテスト

---

## 📅 更新履歴

- 2025-01-XX: 初版作成



