<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SalesMind - AI営業思考トレーナー</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <!-- ヘッダー -->
        <header class="header">
            <h1>🧠 SalesMind</h1>
            <p class="subtitle">AI営業思考トレーナー - SPINメソッドで商談スキルを向上</p>
            <div class="auth-section">
                <div id="authTabs" class="auth-tabs">
                    <button class="tab-button active" onclick="showLoginTab()">ログイン</button>
                    <button class="tab-button" onclick="showRegisterTab()">新規登録</button>
                </div>
                <div id="loginForm" class="auth-form">
                    <h3>ログイン</h3>
                    <input type="text" id="loginUsername" placeholder="ユーザー名">
                    <input type="password" id="loginPassword" placeholder="パスワード">
                    <button onclick="login()">ログイン</button>
                    <div id="loginError" class="error-message" style="display: none;"></div>
                </div>
                <div id="registerForm" class="auth-form" style="display: none;">
                    <h3>新規登録</h3>
                    <input type="text" id="registerUsername" placeholder="ユーザー名（3文字以上）">
                    <input type="email" id="registerEmail" placeholder="メールアドレス（オプション）">
                    <input type="password" id="registerPassword" placeholder="パスワード（6文字以上）">
                    <button onclick="register()">登録</button>
                    <div id="registerError" class="error-message" style="display: none;"></div>
                </div>
                <div id="userInfo" class="user-info" style="display: none;">
                    <span>ようこそ、<strong id="usernameDisplay"></strong>さん</span>
                    <button onclick="logout()">ログアウト</button>
                </div>
            </div>
        </header>

        <!-- メインコンテンツ -->
        <main class="main-content">
            <!-- ステップ0: モード選択 -->
            <section id="step0" class="step-section active">
                <h2>診断モードを選択してください</h2>
                <div class="mode-selection-container">
                    <div class="mode-card">
                        <div class="mode-icon">⚡</div>
                        <h3>簡易診断モード</h3>
                        <p class="mode-description">手軽にSPIN質問を生成してトレーニングを開始できます</p>
                        <ul class="mode-features">
                            <li>✓ 手動入力で簡単に開始</li>
                            <li>✓ 企業情報不要</li>
                            <li>✓ すぐにトレーニング開始</li>
                        </ul>
                        <div class="mode-buttons">
                            <button class="mode-select-btn" onclick="selectMode('simple')">このモードを選択</button>
                            <button class="mode-ranking-btn" onclick="showRanking('simple')">🏆 ランキング</button>
                        </div>
                    </div>
                    <div class="mode-card">
                        <div class="mode-icon">🔍</div>
                        <h3>詳細診断モード</h3>
                        <p class="mode-description">企業情報を取得して、より実践的なトレーニングが可能です</p>
                        <ul class="mode-features">
                            <li>✓ 企業情報を自動取得</li>
                            <li>✓ SPIN適合性分析</li>
                            <li>✓ 具体的な質問生成</li>
                        </ul>
                        <div class="mode-buttons">
                            <button class="mode-select-btn" onclick="selectMode('detailed')">このモードを選択</button>
                            <button class="mode-ranking-btn" onclick="showRanking('detailed')">🏆 ランキング</button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- ステップ1: 提案予定の企業情報（簡易診断モード用） -->
            <section id="step1-simple" class="step-section" style="display: none;">
                <div class="step-header">
                    <h2>提案予定の企業情報</h2>
                    <button onclick="returnToModeSelection()" class="btn-back-to-mode">← モード選択に戻る</button>
                </div>
                <div class="info-box">
                    <p>提案予定の企業情報を入力してください。</p>
                </div>
                <div class="form-group">
                    <label>業界 *</label>
                    <input type="text" id="industry" placeholder="例: IT" value="IT" required>
                </div>
                <div class="form-group">
                    <label>価値提案 *</label>
                    <input type="text" id="value_proposition" placeholder="例: クラウド導入支援サービス" value="クラウド導入支援サービス" required>
                </div>
                <div class="form-group">
                    <label>顧客像（オプション）</label>
                    <input type="text" id="customer_persona" placeholder="例: 中堅IT企業のCTO" value="">
                </div>
                <button onclick="startDiagnosis()" class="btn-primary">診断開始</button>
                <div id="diagnosisStartResult" class="result-box" style="display: none;">
                    <!-- ローディングやエラーメッセージがここに表示される -->
                </div>
            </section>

            <!-- ステップ1: 企業情報取得（詳細診断モード用） -->
            <section id="step1-detailed" class="step-section" style="display: none;">
                <div class="step-header">
                    <h2>提案予定の企業情報</h2>
                    <button onclick="returnToModeSelection()" class="btn-back-to-mode">← モード選択に戻る</button>
                </div>
                <div class="info-box">
                    <p>企業URLから企業情報を取得して、より実践的な診断を行います。</p>
                </div>
                <div class="form-group">
                    <label>企業URL *</label>
                    <input type="url" id="company_url" placeholder="例: https://example.com" required>
                    <small class="form-help">企業の公式サイトや会社概要ページのURLを入力してください</small>
                </div>
                <div class="form-group">
                    <label>価値提案 *</label>
                    <input type="text" id="detailed_value_proposition" placeholder="例: クラウド導入支援サービス" required>
                </div>
                <div class="form-group">
                    <label>顧客像（オプション）</label>
                    <input type="text" id="detailed_customer_persona" placeholder="例: 中堅IT企業のCTO" value="">
                </div>
                <button onclick="fetchCompanyInfo()" class="btn-primary">企業情報を取得</button>
                <div id="companyInfoResult" class="result-box" style="display: none;">
                    <!-- 企業情報がここに表示される -->
                </div>
            </section>

            <!-- ステップ2: セッション開始（非表示 - 直接チャットに遷移するため） -->
            <section id="step2" class="step-section" style="display: none;">
                <!-- このセクションは使用されませんが、互換性のために残しています -->
            </section>

            <!-- ステップ3: チャット（AI顧客との対話） -->
            <section id="step3" class="step-section" style="display: none;">
                <div class="step-header">
                    <h2>ステップ3: AI顧客との対話</h2>
                    <button onclick="returnToModeSelection()" class="btn-back-to-mode">← モード選択に戻る</button>
                </div>
                <div class="chat-container">
                    <!-- 企業概要がここに表示される（詳細診断モード用） -->
                    <div id="companySummary" class="company-summary" style="display: none;"></div>
                    
                    <!-- 商談成功率パネル（詳細診断モード用） -->
                    <div id="successMeter" class="success-meter" style="display: none;">
                        <div class="success-meter-header">
                            <h3>📊 商談成功率</h3>
                        </div>
                        <div class="success-meter-content">
                            <div class="success-probability-display">
                                <span class="success-probability-value" id="successProbabilityValue">50</span>
                                <span class="success-probability-unit">%</span>
                            </div>
                            <div class="success-delta-display" id="successDeltaDisplay" style="display: none;">
                                <span class="success-delta-value" id="successDeltaValue">+0</span>
                                <span class="success-delta-unit">%</span>
                            </div>
                            <div class="success-reason-display" id="successReasonDisplay" style="display: none;">
                                <p class="success-reason-text" id="successReasonText"></p>
                            </div>
                            <div class="success-spin-meta" id="successSpinMeta" style="display: none;">
                                <p class="success-spin-item" id="successSpinStage"></p>
                                <p class="success-spin-item" id="successSpinMessage"></p>
                                <p class="success-spin-item" id="successSpinAppropriateness"></p>
                                <p class="success-spin-item" id="successSpinEvaluation"></p>
                                <p class="success-spin-item" id="successSpinSessionStage"></p>
                            </div>
                            <div class="success-system-notes" id="successSystemNotes" style="display: none;"></div>
                        </div>
                    </div>
                    
                    <div id="chatMessages" class="chat-messages">
                        <!-- メッセージがここに表示される -->
                    </div>
                    <div class="chat-input-area">
                        <input type="text" id="chatMessageInput" placeholder="営業担当者の質問を入力..." onkeypress="handleChatKeyPress(event)">
                        <button onclick="sendChatMessage()" class="btn-primary">送信</button>
                    </div>
                    <div class="chat-actions">
                        <button onclick="finishSession()" class="btn-secondary">セッションを終了してスコアリング</button>
                    </div>
                </div>
            </section>

            <!-- ステップ4: スコアリング結果 -->
            <section id="step4" class="step-section" style="display: none;">
                <div class="step-header">
                    <h2>ステップ4: スコアリング結果</h2>
                    <button onclick="returnToModeSelection()" class="btn-back-to-mode">← モード選択に戻る</button>
                </div>
                <div id="scoringResult" class="scoring-result">
                    <!-- スコアリング結果がここに表示される -->
                </div>
                <div class="action-buttons">
                    <button onclick="viewReport()" class="btn-primary">レポート詳細を見る</button>
                    <button onclick="startNewSession()" class="btn-secondary">新しいセッションを開始</button>
                </div>
            </section>

            <!-- ステップ5: レポート詳細 -->
            <section id="step5" class="step-section" style="display: none;">
                <div class="step-header">
                    <h2>レポート詳細</h2>
                    <button onclick="returnToModeSelection()" class="btn-back-to-mode">← モード選択に戻る</button>
                </div>
                <div id="reportDetails" class="report-details">
                    <!-- レポート詳細がここに表示される -->
                </div>
                <div class="action-buttons">
                    <button onclick="viewSessionList()" class="btn-primary">セッション一覧を見る</button>
                    <button onclick="startNewSession()" class="btn-secondary">新しいセッションを開始</button>
                </div>
            </section>

            <!-- セッション一覧 -->
            <section id="sessionList" class="step-section" style="display: none;">
                <div class="step-header">
                    <h2>セッション一覧</h2>
                    <button onclick="returnToModeSelection()" class="btn-back-to-mode">← モード選択に戻る</button>
                </div>
                <button onclick="refreshSessionList()" class="btn-secondary">更新</button>
                <div id="sessionListContent" class="session-list">
                    <!-- セッション一覧がここに表示される -->
                </div>
            </section>

            <!-- ランキング画面 -->
            <section id="ranking" class="step-section" style="display: none;">
                <div class="step-header">
                    <h2 id="rankingTitle">ランキング</h2>
                    <button onclick="returnToModeSelection()" class="btn-back-to-mode">← モード選択に戻る</button>
                </div>
                <div id="rankingContent" class="ranking-content">
                    <div class="ranking-loading" id="rankingLoading">
                        <p>ランキングを読み込み中...</p>
                    </div>
                    <div class="ranking-table-container" id="rankingTable" style="display: none;">
                        <!-- ランキングテーブルがここに表示される -->
                    </div>
                    <div class="ranking-empty" id="rankingEmpty" style="display: none;">
                        <p>まだランキングデータがありません。</p>
                        <p>診断を完了するとランキングに表示されます。</p>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- ログビューアー -->
    <div id="logViewer" class="log-viewer" style="display: none;">
        <div class="log-viewer-header">
            <h2>📋 ログビューアー</h2>
            <div class="log-viewer-actions">
                <button onclick="window.logViewer.exportLogs()" class="btn-secondary">エクスポート</button>
                <button onclick="window.logViewer.clearLogs()" class="btn-secondary">クリア</button>
                <button onclick="window.logViewer.close()" class="btn-secondary">閉じる</button>
            </div>
        </div>
        <div class="log-viewer-filters">
            <label>
                <input type="checkbox" id="filterInfo" checked onchange="window.logViewer.updateLogs()"> Info
            </label>
            <label>
                <input type="checkbox" id="filterWarning" checked onchange="window.logViewer.updateLogs()"> Warning
            </label>
            <label>
                <input type="checkbox" id="filterError" checked onchange="window.logViewer.updateLogs()"> Error
            </label>
            <label>
                <input type="checkbox" id="filterDebug" checked onchange="window.logViewer.updateLogs()"> Debug
            </label>
        </div>
        <div id="logViewerContent" class="log-viewer-content"></div>
    </div>

    <!-- ログビューアー開閉ボタン -->
    <button id="logViewerToggle" class="log-viewer-toggle" onclick="window.logViewer.toggle()" title="ログビューアー">
        📋
    </button>

    <script src="logger.js"></script>
    <script src="log-viewer.js"></script>
    <script src="app.js"></script>
</body>
</html>

