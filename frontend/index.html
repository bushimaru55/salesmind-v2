<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SalesMind - AI営業思考トレーナー</title>
    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="app-layout">
        <!-- 左サイドバーメニュー -->
        <nav class="sidebar">
            <div class="sidebar-logo">
                <span class="sidebar-logo-icon">🧠</span>
            </div>
            <div class="sidebar-menu">
                <a href="#" class="sidebar-item active" onclick="navigateTo('home', event)" title="ホーム">
                    <i class="fas fa-home"></i>
                    <span class="sidebar-tooltip">ホーム</span>
                </a>
                <a href="#" class="sidebar-item" onclick="navigateTo('dashboard', event)" title="ダッシュボード">
                    <i class="fas fa-chart-line"></i>
                    <span class="sidebar-tooltip">ダッシュボード</span>
                </a>
                <a href="#" class="sidebar-item" onclick="navigateTo('diagnosis', event)" title="診断">
                    <i class="fas fa-stethoscope"></i>
                    <span class="sidebar-tooltip">診断開始</span>
                </a>
                <a href="#" class="sidebar-item" onclick="navigateTo('history', event)" title="履歴">
                    <i class="fas fa-history"></i>
                    <span class="sidebar-tooltip">履歴</span>
                </a>
                <a href="#" class="sidebar-item" onclick="navigateTo('ranking', event)" title="ランキング">
                    <i class="fas fa-trophy"></i>
                    <span class="sidebar-tooltip">ランキング</span>
                </a>
                <a href="#" class="sidebar-item" onclick="navigateTo('settings', event)" title="設定">
                    <i class="fas fa-cog"></i>
                    <span class="sidebar-tooltip">設定</span>
                </a>
            </div>
            <div class="sidebar-bottom">
                <a href="#" class="sidebar-item" id="sidebarUserBtn" onclick="showLoginModal()" title="ログイン">
                    <i class="fas fa-user"></i>
                    <span class="sidebar-tooltip" id="sidebarUserTooltip">ログイン</span>
                </a>
            </div>
        </nav>

        <!-- メインコンテンツ -->
        <div class="main-wrapper">
            <div class="container">
                <!-- ヘッダー -->
                <header class="header">
                    <div class="header-left">
                        <div class="logo">
                            <span class="logo-icon">🧠</span>
                            <span class="logo-text">SalesMind</span>
                        </div>
                    </div>
                    <div class="header-right">
                        <div id="headerUserInfo" class="header-user-info" style="display: none;">
                            <span class="user-name" id="headerUsernameDisplay"></span>
                            <button onclick="logout()" class="btn-logout">ログアウト</button>
                        </div>
                        <div id="headerAuthButtons" class="header-auth-buttons">
                            <button onclick="showLoginModal()" class="btn-login">ログイン</button>
                            <button onclick="showRegisterModal()" class="btn-register">新規登録</button>
                        </div>
                    </div>
                </header>

        <!-- ログイン・登録モーダル -->
        <div id="authModal" class="modal" style="display: none;">
            <div class="modal-content">
                <span class="modal-close" onclick="closeAuthModal()">&times;</span>
                <h2 id="modalTitle">ログイン</h2>
                <div id="authTabs" class="auth-tabs">
                    <button class="tab-button active" onclick="showLoginTab()">ログイン</button>
                    <button class="tab-button" onclick="showRegisterTab()">新規登録</button>
                </div>
                <div id="loginForm" class="auth-form">
                    <form onsubmit="event.preventDefault(); login(); return false;" autocomplete="on">
                        <input type="text" id="loginUsername" name="username" placeholder="ユーザー名" autocomplete="username">
                        <input type="password" id="loginPassword" name="password" placeholder="パスワード" autocomplete="current-password">
                        <button type="submit" class="btn-primary">ログイン</button>
                    </form>
                    <div id="loginError" class="error-message" style="display: none;"></div>
                </div>
                <div id="registerForm" class="auth-form" style="display: none;">
                    <form onsubmit="event.preventDefault(); register(); return false;" autocomplete="on">
                        <input type="text" id="registerUsername" name="username" placeholder="ユーザー名（3文字以上）" autocomplete="username">
                        <input type="email" id="registerEmail" name="email" placeholder="メールアドレス（オプション）" autocomplete="email">
                        <input type="password" id="registerPassword" name="password" placeholder="パスワード（6文字以上）" autocomplete="new-password">
                        <button type="submit" class="btn-primary">登録</button>
                    </form>
                    <div id="registerError" class="error-message" style="display: none;"></div>
                </div>
            </div>
        </div>

        <!-- メインコンテンツ -->
        <main class="main-content">
            <!-- ステップ0: モード選択 -->
            <section id="step0" class="step-section active">
                <h2>診断モードを選択してください</h2>
                <div class="mode-selection-container">
                    <div class="mode-card">
                        <div class="mode-icon">⚡</div>
                        <h3>簡易診断モード</h3>
                        <p class="mode-description">手軽にSPIN質問を生成してトレーニングを開始できます</p>
                        <ul class="mode-features">
                            <li>✓ 手動入力で簡単に開始</li>
                            <li>✓ 企業情報不要</li>
                            <li>✓ すぐにトレーニング開始</li>
                        </ul>
                        <div class="mode-buttons">
                            <button class="mode-select-btn" onclick="selectMode('simple')">このモードを選択</button>
                            <button class="mode-ranking-btn" onclick="showRanking('simple')">🏆 ランキング</button>
                        </div>
                    </div>
                    <div class="mode-card">
                        <div class="mode-icon">🔍</div>
                        <h3>詳細診断モード</h3>
                        <p class="mode-description">企業情報を取得して、より実践的なトレーニングが可能です</p>
                        <ul class="mode-features">
                            <li>✓ 企業情報を自動取得</li>
                            <li>✓ SPIN適合性分析</li>
                            <li>✓ 具体的な質問生成</li>
                        </ul>
                        <div class="mode-buttons">
                            <button class="mode-select-btn" onclick="selectMode('detailed')">このモードを選択</button>
                            <button class="mode-ranking-btn" onclick="showRanking('detailed')">🏆 ランキング</button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- ステップ1: 提案予定の企業情報（簡易診断モード用） -->
            <section id="step1-simple" class="step-section" style="display: none;">
                <div class="step-header">
                    <h2>提案予定の企業情報</h2>
                    <button onclick="returnToModeSelection()" class="btn-back-to-mode">← モード選択に戻る</button>
                </div>
                <div class="info-box">
                    <p>提案予定の企業情報を入力してください。</p>
                </div>
                <div class="form-group">
                    <label>業界 *</label>
                    <input type="text" id="industry" placeholder="例: IT" value="IT" required>
                </div>
                <div class="form-group">
                    <label>価値提案 *</label>
                    <input type="text" id="value_proposition" placeholder="例: クラウド導入支援サービス" value="クラウド導入支援サービス" required>
                </div>
                <div class="form-group">
                    <label>顧客像（オプション）</label>
                    <input type="text" id="customer_persona" placeholder="例: 中堅IT企業のCTO" value="">
                </div>
                <button onclick="startDiagnosis()" class="btn-primary">診断開始</button>
                <div id="diagnosisStartResult" class="result-box" style="display: none;">
                    <!-- ローディングやエラーメッセージがここに表示される -->
                </div>
            </section>

            <!-- ステップ1: 企業情報取得（詳細診断モード用） -->
            <section id="step1-detailed" class="step-section" style="display: none;">
                <div class="step-header">
                    <h2>提案予定の企業情報</h2>
                    <button onclick="returnToModeSelection()" class="btn-back-to-mode">← モード選択に戻る</button>
                </div>
                <div class="info-box">
                    <p>企業URLから企業情報を取得して、より実践的な診断を行います。</p>
                </div>
                <div class="form-group">
                    <label>企業URL *</label>
                    <input type="url" id="company_url" placeholder="例: https://example.com" required>
                    <small class="form-help">企業の公式サイトや会社概要ページのURLを入力してください</small>
                </div>
                <div class="form-group">
                    <label>価値提案 *</label>
                    <input type="text" id="detailed_value_proposition" placeholder="例: クラウド導入支援サービス" required>
                </div>
                <div class="form-group">
                    <label>顧客像（オプション）</label>
                    <input type="text" id="detailed_customer_persona" placeholder="例: 中堅IT企業のCTO" value="">
                </div>
                <button onclick="fetchCompanyInfo()" class="btn-primary">企業情報を取得</button>
                <div id="companyInfoResult" class="result-box" style="display: none;">
                    <!-- 企業情報がここに表示される -->
                </div>
            </section>

            <!-- ステップ2: セッション開始（非表示 - 直接チャットに遷移するため） -->
            <section id="step2" class="step-section" style="display: none;">
                <!-- このセクションは使用されませんが、互換性のために残しています -->
            </section>

            <!-- ステップ3: チャット（AI顧客との対話） -->
            <section id="step3" class="step-section" style="display: none;">
                <div class="chat-two-column">
                    <!-- 左カラム：チャット -->
                    <div class="chat-left-column">
                        <div class="chat-header">
                            <h3>💬 チャット</h3>
                        </div>
                        <div id="chatMessages" class="chat-messages">
                            <!-- メッセージがここに表示される -->
                        </div>
                        <div class="chat-input-area">
                            <input type="text" id="chatMessageInput" placeholder="営業担当者の質問を入力..." onkeypress="handleChatKeyPress(event)">
                            <button onclick="sendChatMessage()" class="btn-primary">送信</button>
                        </div>
                    </div>

                    <!-- 右カラム：進捗状況と評価 -->
                    <div class="chat-right-column">
                        <!-- 企業概要（詳細診断モード用） -->
                        <div id="companySummary" class="company-summary-sidebar" style="display: none;"></div>
                        
                        <!-- 商談成功率パネル（詳細診断モード用） -->
                        <div id="successMeter" class="success-meter-sidebar" style="display: none;">
                            <div class="success-meter-header">
                                <h3>📊 商談成功率</h3>
                            </div>
                            <div class="success-meter-content">
                                <div class="success-probability-display">
                                    <span class="success-probability-value" id="successProbabilityValue">50</span>
                                    <span class="success-probability-unit">%</span>
                                </div>
                                <div class="success-delta-display" id="successDeltaDisplay" style="display: none;">
                                    <span class="success-delta-value" id="successDeltaValue">+0</span>
                                    <span class="success-delta-unit">%</span>
                                </div>
                                <div class="success-reason-display" id="successReasonDisplay" style="display: none;">
                                    <p class="success-reason-text" id="successReasonText"></p>
                                </div>
                                <div class="success-spin-meta" id="successSpinMeta" style="display: none;">
                                    <p class="success-spin-item" id="successSpinStage"></p>
                                    <p class="success-spin-item" id="successSpinMessage"></p>
                                    <p class="success-spin-item" id="successSpinAppropriateness"></p>
                                    <p class="success-spin-item" id="successSpinEvaluation"></p>
                                    <p class="success-spin-item" id="successSpinSessionStage"></p>
                                </div>
                                <div class="success-system-notes" id="successSystemNotes" style="display: none;"></div>
                            </div>
                        </div>

                        <!-- アクションボタン -->
                        <div class="chat-actions-sidebar">
                            <button onclick="finishSession()" class="btn-secondary btn-block">セッションを終了してスコアリング</button>
                            <button onclick="returnToModeSelection()" class="btn-back-to-mode btn-block">← モード選択に戻る</button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- ステップ4: スコアリング結果 -->
            <section id="step4" class="step-section" style="display: none;">
                <div class="step-header">
                    <h2>ステップ4: スコアリング結果</h2>
                    <button onclick="returnToModeSelection()" class="btn-back-to-mode">← モード選択に戻る</button>
                </div>
                <div id="scoringResult" class="scoring-result">
                    <!-- スコアリング結果がここに表示される -->
                </div>
                <div class="action-buttons">
                    <button onclick="viewReport()" class="btn-primary">レポート詳細を見る</button>
                    <button onclick="startNewSession()" class="btn-secondary">新しいセッションを開始</button>
                </div>
            </section>

            <!-- ステップ5: レポート詳細 -->
            <section id="step5" class="step-section" style="display: none;">
                <div class="step-header">
                    <h2>レポート詳細</h2>
                    <button onclick="returnToModeSelection()" class="btn-back-to-mode">← モード選択に戻る</button>
                </div>
                <div id="reportDetails" class="report-details">
                    <!-- レポート詳細がここに表示される -->
                </div>
                <div class="action-buttons">
                    <button onclick="viewSessionList()" class="btn-primary">セッション一覧を見る</button>
                    <button onclick="startNewSession()" class="btn-secondary">新しいセッションを開始</button>
                </div>
            </section>

            <!-- セッション一覧 -->
            <section id="sessionList" class="step-section" style="display: none;">
                <div class="step-header">
                    <h2>セッション一覧</h2>
                    <button onclick="returnToModeSelection()" class="btn-back-to-mode">← モード選択に戻る</button>
                </div>
                <button onclick="refreshSessionList()" class="btn-secondary">更新</button>
                <div id="sessionListContent" class="session-list">
                    <!-- セッション一覧がここに表示される -->
                </div>
            </section>

            <!-- ランキング画面 -->
            <section id="ranking" class="step-section" style="display: none;">
                <div class="step-header">
                    <h2 id="rankingTitle">ランキング</h2>
                    <button onclick="returnToModeSelection()" class="btn-back-to-mode">← モード選択に戻る</button>
                </div>
                <div id="rankingContent" class="ranking-content">
                    <div class="ranking-loading" id="rankingLoading">
                        <p>ランキングを読み込み中...</p>
                    </div>
                    <div class="ranking-table-container" id="rankingTable" style="display: none;">
                        <!-- ランキングテーブルがここに表示される -->
                    </div>
                    <div class="ranking-empty" id="rankingEmpty" style="display: none;">
                        <p>まだランキングデータがありません。</p>
                        <p>診断を完了するとランキングに表示されます。</p>
                    </div>
                </div>
            </section>

            <!-- ダッシュボード -->
            <section id="dashboard" class="step-section" style="display: none;">
                <div class="step-header">
                    <h2>ダッシュボード</h2>
                    <button onclick="returnToModeSelection()" class="btn-back-to-mode">← モード選択に戻る</button>
                </div>
                <div class="dashboard-container">
                    <!-- 統計カード -->
                    <div class="dashboard-stats">
                        <div class="stat-card">
                            <div class="stat-icon"><i class="fas fa-comments"></i></div>
                            <div class="stat-content">
                                <div class="stat-value" id="totalSessionsCount">-</div>
                                <div class="stat-label">総セッション数</div>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon"><i class="fas fa-chart-bar"></i></div>
                            <div class="stat-content">
                                <div class="stat-value" id="averageScoreValue">-</div>
                                <div class="stat-label">平均スコア</div>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon"><i class="fas fa-medal"></i></div>
                            <div class="stat-content">
                                <div class="stat-value" id="highestScoreValue">-</div>
                                <div class="stat-label">最高スコア</div>
                            </div>
                        </div>
                    </div>

                    <!-- 直近のセッション履歴 -->
                    <div class="dashboard-section">
                        <h3><i class="fas fa-history"></i> 直近のセッション</h3>
                        <div id="recentSessionsList" class="recent-sessions-list">
                            <p class="loading-text">セッション履歴を読み込み中...</p>
                        </div>
                    </div>

                    <!-- 設定エリア（将来の拡張用プレースホルダー） -->
                    <div class="dashboard-section settings-section">
                        <h3><i class="fas fa-cog"></i> 設定 <span class="coming-soon-badge">Coming Soon</span></h3>
                        <div class="settings-placeholder">
                            <p><i class="fas fa-user-cog"></i> ペルソナ設定などユーザー個別の設定機能は今後追加予定です。</p>
                        </div>
                    </div>
                </div>
            </section>
        </main>
            </div>
        </div>
    </div>

    <!-- ログビューアー -->
    <div id="logViewer" class="log-viewer" style="display: none;">
        <div class="log-viewer-header">
            <h2>📋 ログビューアー</h2>
            <div class="log-viewer-actions">
                <button onclick="window.logViewer.exportLogs()" class="btn-secondary">エクスポート</button>
                <button onclick="window.logViewer.clearLogs()" class="btn-secondary">クリア</button>
                <button onclick="window.logViewer.close()" class="btn-secondary">閉じる</button>
            </div>
        </div>
        <div class="log-viewer-filters">
            <label>
                <input type="checkbox" id="filterInfo" checked onchange="window.logViewer.updateLogs()"> Info
            </label>
            <label>
                <input type="checkbox" id="filterWarning" checked onchange="window.logViewer.updateLogs()"> Warning
            </label>
            <label>
                <input type="checkbox" id="filterError" checked onchange="window.logViewer.updateLogs()"> Error
            </label>
            <label>
                <input type="checkbox" id="filterDebug" checked onchange="window.logViewer.updateLogs()"> Debug
            </label>
        </div>
        <div id="logViewerContent" class="log-viewer-content"></div>
    </div>

    <!-- ログビューアー開閉ボタン -->
    <button id="logViewerToggle" class="log-viewer-toggle" onclick="window.logViewer.toggle()" title="ログビューアー">
        📋
    </button>

    <script src="logger.js"></script>
    <script src="log-viewer.js"></script>
    <script src="app.js"></script>
</body>
</html>

